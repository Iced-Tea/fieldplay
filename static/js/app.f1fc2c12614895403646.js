webpackJsonp([4],{"3xg8":function(e,n,t){"use strict";function r(e){function n(n){p.setCustomVectorField(n);var t=p.getFragmentShader(),r=p.getVertexShader(),o=a.a.createProgram(y,r,t);h&&h.unload(),h=o,e.colorMode===u.a.VELOCITY&&w.requestSpeedUpdate()}function r(n,r){_=e.particleStateResolution;var o=[{name:"x",particleState:n},{name:"y",particleState:r}];x&&x.dispose(),x=t.i(s.a)(y,o,_),g&&g.dispose(),g=t.i(s.a)(y,o,_),w.onParticleInit()}function i(n){var t=e.colorMode;t===u.a.UNIFORM?y.uniform4f(n.u_particle_color,T.r,T.g,T.b,T.a):t===u.a.VELOCITY&&w.setColorMinMax(n),x.bindTextures(y,n)}function d(){var n=h;y.useProgram(n.program),a.a.bindAttribute(y,e.quadBuffer,n.a_pos,2),e.audioTexture&&(a.a.bindTexture(y,e.audioTexture,5),y.uniform1i(n.u_audio,5)),x.bindTextures(y,n),y.uniform1f(n.u_rand_seed,e.frameSeed),y.uniform1f(n.u_h,e.integrationTimeStep),y.uniform1f(n.frame,e.frame);var t=e.bbox;y.uniform2f(n.u_min,t.minX,t.minY),y.uniform2f(n.u_max,t.maxX,t.maxY),y.uniform1f(n.u_drop_rate,e.dropProbability);for(var r=0;r<g.length;++r){var o=g.get(r);y.uniform1i(n.u_out_coordinate,r),a.a.bindFramebuffer(y,e.framebuffer,o.texture),y.viewport(0,0,_,_),y.drawArrays(y.TRIANGLES,0,6)}e.colorMode===u.a.VELOCITY&&w.updateParticlesPositions(n),b&&(v(n),b=null);var i=x;x=g,g=i}function l(e){b=e}function v(n){var r=[{name:"x",particleState:b.x},{name:"y",particleState:b.y}],i=b.resolution,u=i*i,c=t.i(s.a)(y,r,i),d=t.i(s.a)(y,r,i);c.bindTextures(y,n);var l=d.get(0);y.uniform1i(n.u_out_coordinate,6),a.a.bindFramebuffer(y,e.framebuffer,l.texture),y.viewport(0,0,i,i),y.drawArrays(y.TRIANGLES,0,6);var p=new Uint8Array(4*u);y.readPixels(0,0,i,i,y.RGBA,y.UNSIGNED_BYTE,p),y.uniform1i(n.u_out_coordinate,7),l=d.get(1),a.a.bindFramebuffer(y,e.framebuffer,l.texture),y.viewport(0,0,i,i),y.drawArrays(y.TRIANGLES,0,6);var v=new Uint8Array(4*u);y.readPixels(0,0,i,i,y.RGBA,y.UNSIGNED_BYTE,v),d.dispose(),c.dispose();for(var x=t.i(f.a)(),g=t.i(f.a)(),_=new Float32Array(u),h=new Float32Array(u),T=0;T<v.length;T+=4){var w=T/4,E=o(p,T),P=o(v,T);_[w]=E,h[w]=P,x.add(E),g.add(P)}var A={xStats:x,yStats:g,decoded_velocity_x:_,decoded_velocity_y:h,resolution:i};m.a.fire("vector-line-ready",A)}var x,g,_,h,b,y=e.gl,T={r:77/255,g:188/255,b:201/255,a:1},w=t.i(c.a)(e);return m.a.on("vector-lines-request",l),{updateCode:n,updateParticlesPositions:d,onParticleInit:r,prepareToDraw:i}}function o(e,n){return t.i(d.b)(e[n+0],e[n+1],e[n+2],e[n+3])}n.a=r;var a=t("Ddjs"),i=t("Qv35"),u=t("6c6E"),c=t("gIFv"),s=t("pXNl"),f=t("V39N"),d=t("FaU1"),l=t("eBcr"),m=t.n(l),p=new i.a},"4KA4":function(e,n,t){"use strict";var r=t("Zrlr"),o=t.n(r),a=t("wxAW"),i=t.n(a),u=function(){function e(){o()(this,e)}return i()(e,[{key:"getDefines",value:function(){return""}},{key:"getFunctions",value:function(){return""}},{key:"getMainBody",value:function(){return""}}]),e}();n.a=u},"6c6E":function(e,n,t){"use strict";n.a={UNIFORM:1,VELOCITY:2,ANGLE:3}},"94y8":function(e,n,t){"use strict";function r(e){function n(){a.a.off("audio",r),o.deleteTexture(c)}function t(){if(s){s=!1;o.bindTexture(o.TEXTURE_2D,c),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,5,5,0,o.RGBA,o.UNSIGNED_BYTE,u),o.bindTexture(o.TEXTURE_2D,null)}}function r(e){u=e,s=!0}var o=e.gl,u=new Uint8Array(256),c=i.a.createTexture(o,o.NEAREST,u,8,8),s=!1;return e.audioTexture=c,a.a.on("audio",r),{updateTextures:t,dispose:n}}var o=t("eBcr"),a=t.n(o),i=t("Ddjs");n.a=r},Ddjs:function(e,n,t){"use strict";function r(e,n,t){e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_2D,n)}function o(e,n){var t=e.createBuffer();return e.bindBuffer(e.ARRAY_BUFFER,t),e.bufferData(e.ARRAY_BUFFER,n,e.STATIC_DRAW),t}function a(e,n,t,r,o){var a=e.createTexture();return e.bindTexture(e.TEXTURE_2D,a),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,n),t instanceof Uint8Array?e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r,o,0,e.RGBA,e.UNSIGNED_BYTE,t):e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),e.bindTexture(e.TEXTURE_2D,null),a}function i(e,n,t){e.bindFramebuffer(e.FRAMEBUFFER,n),t&&e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}function u(e,n,t,r){e.bindBuffer(e.ARRAY_BUFFER,n),e.enableVertexAttribArray(t),e.vertexAttribPointer(t,r,e.FLOAT,!1,0,0)}function c(e,n,t){function r(){e.deleteProgram(o)}var o=e.createProgram(),a=s(e,e.VERTEX_SHADER,n),i=s(e,e.FRAGMENT_SHADER,t);if(e.attachShader(o,a),e.attachShader(o,i),e.linkProgram(o),!e.getProgramParameter(o,e.LINK_STATUS))throw new Error(e.getProgramInfoLog(o));var u,c={program:o,unload:r},f=e.getProgramParameter(o,e.ACTIVE_ATTRIBUTES);for(u=0;u<f;u++){var d=e.getActiveAttrib(o,u);c[d.name]=e.getAttribLocation(o,d.name)}var l=e.getProgramParameter(o,e.ACTIVE_UNIFORMS);for(u=0;u<l;u++){var m=e.getActiveUniform(o,u);c[m.name]=e.getUniformLocation(o,m.name)}return c}function s(e,n,t){var r=e.createShader(n);if(e.shaderSource(r,t),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS))throw new Error(e.getShaderInfoLog(r));return r}n.a={createTexture:a,bindFramebuffer:i,createProgram:c,createBuffer:o,bindAttribute:u,bindTexture:r}},DuZ1:function(e,n,t){"use strict";var r=t("Zx67"),o=t.n(r),a=t("Zrlr"),i=t.n(a),u=t("wxAW"),c=t.n(u),s=t("zwoO"),f=t.n(s),d=t("Pf15"),l=t.n(d),m=t("4KA4"),p=t("JjDM"),v=function(e){function n(e){i()(this,n);var t=f()(this,(n.__proto__||o()(n)).call(this));return t.updateCode=e||"",t}return l()(n,e),c()(n,[{key:"setNewUpdateCode",value:function(e){this.updateCode=e}},{key:"getDefines",value:function(){return"\nuniform float frame;\nuniform sampler2D u_audio;\n\n#define PI 3.1415926535897932384626433832795\n"}},{key:"getFunctions",value:function(){return"\n"+p.a+"\n\nvec2 rotate(vec2 p,float a) {\n\treturn cos(a)*p+sin(a)*vec2(p.y,-p.x);\n}\n\n// TODO: This will change. Don't use it.\nfloat audio(float index) {\n  float rgbI = floor(index/4.);\n  vec2 txPos = vec2(fract(rgbI / 5.), floor(rgbI / 5.) / 5.);\n  vec4 rgba = texture2D(u_audio, txPos);\n  \n  float offset = mod(index, 4.);\n  if (offset == 0.) return rgba[0];\n  if (offset == 1.) return rgba[1];\n  if (offset == 2.) return rgba[2];\n  return rgba[3];\n}\n\nvec2 get_velocity(const vec2 p) {\n  vec2 v = vec2(0.);\n  "+(this.updateCode?this.updateCode:"")+"\n  return v;\n}\n  "}}]),n}(m.a);n.a=v},FaU1:function(e,n,t){"use strict";function r(e,n,t){if(0==e)return n[t+0]=0,n[t+1]=0,n[t+2]=0,void(n[t+3]=0);var r=Math.abs(e),o=Math.floor(u()(r));o+=a(o)<=r/2?1:0,o-=a(o)>r?1:0;var i;i=o>100?r/1024/a(o-10)-1:r/a(o)-1;var c=o+127;i*=256;var s=Math.floor(i);i-=s,i*=256;var f=Math.floor(i);i-=f,i*=128;var d=2*Math.floor(i)+(e<0?1:0);n[t+0]=c,n[t+1]=s,n[t+2]=f,n[t+3]=d}function o(e,n,t,r){var o=Math.floor(e+.5),i=Math.floor(n+.5),u=Math.floor(t+.5),c=Math.floor(r+.5),s=o-127;return(1-c%2*2)*((o>0?1:0)+i/256+u/65536+Math.floor(c/2)/8388608)*a(s)}function a(e){return Math.exp(e*Math.LN2)}n.a=r,n.b=o;var i=t("yI0F"),u=t.n(i)},JHsM:function(e,n,t){"use strict";function r(e){function n(){return Q&&Q.error}function r(e){if(e){var n=s()({},$.bbox);if(o(e,"minX",n),o(e,"minY",n),o(e,"maxX",n),o(e,"maxY",n),void 0!==e.minY||void 0!==e.maxY){var t=Math.abs(n.minY-n.maxY)/Math.abs($.bbox.minY-$.bbox.maxY),r=($.bbox.maxX+$.bbox.minX)/2,a=($.bbox.maxX-$.bbox.minX)/2;n.minX=r-a*t,n.maxX=r+a*t}V(n)}}function o(e,n,t){var r=u()(e[n]);a()(r)&&(t[n]=r)}function i(e){Z=e}function c(){Z=null}function d(e){var n=parseInt(e,10);v.a.setColorMode(n),$.colorMode=v.a.getColorMode(),te.updateColorMode(n)}function m(){return v.a.getColorMode()}function b(){return v.a.getIntegrationTimeStep()}function y(e){var n=parseFloat(e);a()(n)&&($.integrationTimeStep=n,v.a.setIntegrationTimeStep(n),p.a.fire("integration-timestep-changed",n))}function T(e){ee=e,U()}function w(e){var n=parseFloat(e);a()(n)&&($.fadeOpacity=n,v.a.setFadeout(n))}function E(){return v.a.getFadeout()}function P(){return v.a.getParticleCount()}function A(e){a()(e)&&e!==q&&(e<1||(k(e),q=e,v.a.setParticleCount(e)))}function M(e){var n=parseFloat(e);a()(n)&&(v.a.setDropProbability(n),$.dropProbability=n)}function F(){return v.a.getDropProbability()}function R(){return v.a.getCode()}function C(e){if(e===H)return n();var t=B(e);if(t&&t.error)return t;H=e,v.a.saveCode(e)}function S(){Q=t.i(g.a)(H),p.a.fire("glsl-parser-result-changed",Q.error)}function B(e){if(Q=t.i(g.a)(e),Q.error)return Q.error;try{te.updateCode(Q.code)}catch(e){return{error:e.message}}}function D(){I(window.innerWidth,window.innerHeight),ne.updateScreenTextures(),L(K)}function I(n,t){var r=Math.max(.02*n,30),o=Math.max(.02*t,30);W.width=n+2*r,W.height=t+2*o,W.top=-o,W.left=-r;var a=e.canvas;a.width=W.width,a.height=W.height,a.style.left=-r+"px",a.style.top=-o+"px"}function X(){N(),oe.dispose(),window.removeEventListener("resize",D,!0)}function U(){J||ee||(J=requestAnimationFrame(Y))}function N(){cancelAnimationFrame(J),J=0}function Y(){J=0,O(),Z&&Z.capture(e.canvas),U()}function O(){ne.fadeOutLastFrame(),te.drawParticles(),ne.renderCurrentScreen(),te.updateParticlesPositions()}function k(e){$.particleStateResolution=Math.ceil(Math.sqrt(e)),te.onParticleInit()}function G(){var e=v.a.getBBox(),n=W.width,t=W.height,r=Math.PI*Math.E,o=Math.PI*Math.E,a=0,i=0;e&&(r=e.maxX-e.minX,o=e.maxY-e.minY,a=n*(e.minX+e.maxX)/2,i=n*(e.minY+e.maxY)/2);var u=r*n/2,c=o*t/2;oe.showRectangle({left:-u+a,top:-c-i,right:u+a,bottom:c-i})}function L(e){function n(n){return(n-e.x)/e.scale}function t(n){return(n-e.y)/e.scale}ne.boundingBoxUpdated=!0,K.x=e.x,K.y=e.y,K.scale=e.scale;var r=W.width,o=W.height,a=n(0),i=t(0),u=n(r),c=t(o),s=1e4;j.minX=Math.round(s*a/r)/s,j.minY=Math.round(s*-i/r)/s,j.maxX=Math.round(s*u/r)/s,j.maxY=Math.round(s*-c/r)/s,v.a.saveBBox(j),p.a.fire("bbox-change",j)}function z(){var e=Math.PI*Math.E*.5,n=Math.PI*Math.E*.5;V({minX:-e,minY:-n,maxX:e,maxY:n})}function V(e){v.a.saveBBox(e,!0),G(),oe.moveBy(0,0,!1)}var W={width:0,height:0,top:0,left:0};I(e.canvas.width,e.canvas.height),window.addEventListener("resize",D,!0),p.a.on("start-record",i),p.a.on("stop-record",c),p.a.on("glsl-parser-ready",S);var Z=null,j=v.a.getBBox()||{},K={scale:1,x:0,y:0},q=v.a.getParticleCount(),H=v.a.getCode();e.disable(e.DEPTH_TEST),e.disable(e.STENCIL_TEST);var J,Q,$={gl:e,bbox:j,canvasRect:W,framebuffer:e.createFramebuffer(),quadBuffer:f.a.createBuffer(e,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1])),colorMode:v.a.getColorMode(),screenTextureUnit:3,colorTextureUnit:2,integrationTimeStep:v.a.getIntegrationTimeStep(),dropProbability:v.a.getDropProbability(),frame:0,particleStateResolution:0,fadeOpacity:v.a.getFadeout(),audioTexture:null},ee=!1,ne=t.i(_.a)($),te=t.i(h.a)($);!function(){var e=v.a.getCode();if(e){var n=B(e);if(!n)return;console.error("Failed to restore previous vector field: ",n.error)}B(v.a.getDefaultCode())}(),k(q);var re={start:U,stop:N,dispose:X,resetBoundingBox:z,moveBoundingBox:r,setPaused:T,updateVectorField:C,getCurrentCode:R,getParticlesCount:P,setParticlesCount:A,setFadeOutSpeed:w,getFadeOutSpeed:E,setDropProbability:M,getDropProbability:F,getIntegrationTimeStep:b,setIntegrationTimeStep:y,setColorMode:d,getColorMode:m,getLastParserResult:n,getCanvasRect:function(){return W},getBoundingBox:function(){return $.bbox}},oe=function(){return l()(e.canvas,{zoomSpeed:.025,controller:t.i(x.a)(e.canvas,L)})}();return G(),setTimeout(function(){p.a.fire("scene-ready",re)}),re}n.a=r;var o=t("AMV0"),a=t.n(o),i=t("5dBV"),u=t.n(i),c=t("woOf"),s=t.n(c),f=t("Ddjs"),d=t("yBIK"),l=t.n(d),m=t("eBcr"),p=t.n(m),v=t("NEgR"),x=t("p0IO"),g=t("MzG0"),_=t("h62Y"),h=t("pKWO")},JjDM:function(e,n,t){"use strict";n.a="\nvec3 mod289(vec3 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec2 mod289(vec2 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec3 permute(vec3 x) {\n  return mod289(((x*34.0)+1.0)*x);\n}\n\nfloat snoise(vec2 v)\n  {\n  const vec4 C = vec4(0.211324865405187,  // (3.0-sqrt(3.0))/6.0\n                      0.366025403784439,  // 0.5*(sqrt(3.0)-1.0)\n                     -0.577350269189626,  // -1.0 + 2.0 * C.x\n                      0.024390243902439); // 1.0 / 41.0\n// First corner\n  vec2 i  = floor(v + dot(v, C.yy) );\n  vec2 x0 = v -   i + dot(i, C.xx);\n\n// Other corners\n  vec2 i1;\n  //i1.x = step( x0.y, x0.x ); // x0.x > x0.y ? 1.0 : 0.0\n  //i1.y = 1.0 - i1.x;\n  i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n  // x0 = x0 - 0.0 + 0.0 * C.xx ;\n  // x1 = x0 - i1 + 1.0 * C.xx ;\n  // x2 = x0 - 1.0 + 2.0 * C.xx ;\n  vec4 x12 = x0.xyxy + C.xxzz;\n  x12.xy -= i1;\n\n// Permutations\n  i = mod289(i); // Avoid truncation effects in permutation\n  vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))\n\t\t+ i.x + vec3(0.0, i1.x, 1.0 ));\n\n  vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);\n  m = m*m ;\n  m = m*m ;\n\n// Gradients: 41 points uniformly over a line, mapped onto a diamond.\n// The ring size 17*17 = 289 is close to a multiple of 41 (41*7 = 287)\n\n  vec3 x = 2.0 * fract(p * C.www) - 1.0;\n  vec3 h = abs(x) - 0.5;\n  vec3 ox = floor(x + 0.5);\n  vec3 a0 = x - ox;\n\n// Normalise gradients implicitly by scaling m\n// Approximation of: m *= inversesqrt( a0*a0 + h*h );\n  m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );\n\n// Compute final noise value at P\n  vec3 g;\n  g.x  = a0.x  * x0.x  + h.x  * x0.y;\n  g.yz = a0.yz * x12.xz + h.yz * x12.yw;\n  return 130.0 * dot(m, g);\n}\n"},MzG0:function(e,n,t){"use strict";function r(e){var n="\nvec2 velocity(vec2 p) {\nvec2 v = vec2(0., 0.);\n"+e+"\nreturn v;\n}",t=s.check(n,{globals:f});return t.code=e,t.log.errorCount&&(t.error=o(t.log)),t}function o(e){var n=e.diagnostics[0],t=n.range,r=t.lineColumn(),o=t.source,u=o._lineOffsets[r.line],c=o.contents.substr(u,r.column);c+=o.contents.substring(t.start,t.end);var s="Line "+r.line+": ",f=n.text;return{error:s+c+"\n"+i(s.length)+i(r.column)+"^",errorDetail:f,isFloatError:a(f)}}function a(e){return e.indexOf('"int"')>-1&&e.indexOf('"float"')>-1}function i(e){return new Array(e+1).join(" ")}n.a=r;var u=t("eBcr"),c=t.n(u),s={check:function(e){return{code:e,log:{errorCount:0}}}};t.e(2).then(function(){s=t("TFw8"),c.a.fire("glsl-parser-ready")}.bind(null,t)).catch(t.oe);var f="\nimport {\n\n  float PI;\n  float snoise(vec2 v);\n  float frame;\n  vec2 rotate(vec2 p,float a);\n  float audio(float index);\n}"},NEgR:function(e,n,t){"use strict";function r(){var e=R.get("cm");return h(e)?e:B.colorMode}function o(e){h(e)&&(R.set({cm:e}),C.cm=e)}function a(){var e=R.get("fo");return h(e)?e:B.fadeout}function i(e){h(e)&&(R.set({fo:e}),C.fo=e)}function u(){var e=R.get("pc");return h(e)?e:B.particleCount}function c(e){h(e)&&(R.set({pc:e}),C.pc=e)}function s(){var e=R.get("dt");return h(e)?e:B.timeStep}function f(e){h(e)&&(R.set({dt:e}),C.dt=e)}function d(){var e=R.get("dp");return h(e)?e:B.dropProbability}function l(e){h(e)&&(b(e,0,1),R.set({dp:e}))}function m(){var e=R.get("cx"),n=R.get("cy"),t=R.get("w"),r=R.get("h");if(h(e)&&h(n)&&h(t)&&h(r)){var o=t/2,a=r/2,i=1e4;return{minX:Math.round(i*(e-o))/i,maxX:Math.round(i*(e+o))/i,minY:Math.round(i*(n-a))/i,maxY:Math.round(i*(n+a))/i}}}function p(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];y&&(clearTimeout(y),y=0),n?v(e):y=setTimeout(function(){return v(e)},300)}function v(e){y=0;var e={cx:.5*(e.minX+e.maxX),cy:.5*(e.minY+e.maxY),w:e.maxX-e.minX,h:e.maxX-e.minX};e.w<=0||e.h<=0||(R.set(e),C.cx=e.cx,C.cy=e.cy,C.w=e.w,C.h=e.h)}function x(){return R.get("code")||S}function g(){return S}function _(e){R.set({code:e}),C.code=e}function h(e){return w()(e)}function b(e,n,t){return e<n?n:e>t?t:e}var y,T=t("AMV0"),w=t.n(T),E=t("3zJd"),P=t.n(E),A=t("eBcr"),M=t.n(A),F=t("6c6E"),R=P()(),C=R.get(),S="v.x = 0.1 * p.y;\nv.y = -0.2 * p.y;",B={timeStep:.01,dropProbability:.009,particleCount:1e4,fadeout:.998,colorMode:F.a.UNIFORM},D={collapsed:window.innerWidth<600};n.a={settingsPanel:D,saveBBox:p,getBBox:m,saveCode:_,getCode:x,getDefaultCode:g,getDropProbability:d,setDropProbability:l,getIntegrationTimeStep:s,setIntegrationTimeStep:f,getParticleCount:u,setParticleCount:c,getFadeout:a,setFadeout:i,getColorMode:r,setColorMode:o},R.onChange(function(e){M.a.fire("scene-ready",window.scene)})},Qv35:function(e,n,t){"use strict";var r=t("Zx67"),o=t.n(r),a=t("zwoO"),i=t.n(a),u=t("Pf15"),c=t.n(u),s=t("Zrlr"),f=t.n(s),d=t("wxAW"),l=t.n(d),m=t("4KA4"),p=t("XMEc"),v=t("S+/9"),x=t("DuZ1"),g=t("vhRe"),_=t("i69e"),h=function(){function e(n){f()(this,e),this.readStoredPosition=new p.a(!0),this.udfVelocity=new x.a,this.integratePositions=new _.a,this.dropParticles=new b,this.writeComputedPosition=new p.a(!1),this.panZoomDecode=new g.a({decode:!0}),this.panZoomEncode=new g.a({decode:!1}),this.colorMode=n&&n.colorMode}return l()(e,[{key:"setCustomVectorField",value:function(e){this.udfVelocity.setNewUpdateCode(e)}},{key:"getVertexShader",value:function(){return"precision highp float;\n\nattribute vec2 a_pos;\nvarying vec2 v_tex_pos;\nuniform vec2 u_min;\nuniform vec2 u_max;\n\nvoid main() {\n    v_tex_pos = a_pos;\n    gl_Position = vec4(1.0 - 2.0 * a_pos, 0, 1);\n}"}},{key:"getFragmentShader",value:function(){var e=[this.readStoredPosition,this.dropParticles,this.udfVelocity,this.integratePositions,{getMainBody:function(){return"\n  vec2 newPos = pos + velocity;\n  "}},this.writeComputedPosition];return t.i(v.a)(e)}}]),e}();n.a=h;var b=function(e){function n(){return f()(this,n),i()(this,(n.__proto__||o()(n)).apply(this,arguments))}return c()(n,e),l()(n,[{key:"getDefines",value:function(){return"\nuniform float u_drop_rate;\nuniform float u_rand_seed;\nuniform vec2 u_min;\nuniform vec2 u_max;\n"}},{key:"getFunctions",value:function(){return"\n// pseudo-random generator\nconst vec3 rand_constants = vec3(12.9898, 78.233, 4375.85453);\nfloat rand(const vec2 co) {\n    float t = dot(rand_constants.xy, co);\n    return fract(sin(t) * (rand_constants.z + t));\n}\n"}},{key:"getMainBody",value:function(){return"\n  // a random seed to use for the particle drop\n  vec2 seed = (pos + v_tex_pos) * u_rand_seed;\n  // drop rate is a chance a particle will restart at random position, to avoid degeneration\n  float drop = step(1.0 - u_drop_rate, rand(seed));\n\n  // TODO: This can be customized to produce various emitters\n  // random_pos is in range from 0..1, we move it to the bounding box:\n  vec2 random_pos = vec2(rand(seed + 1.9), rand(seed + 8.4)) * (u_max - u_min) + u_min;\n  pos = mix(pos, random_pos, drop);\n"}}]),n}(m.a)},"S+/9":function(e,n,t){"use strict";function r(e){function n(e){e&&t.push(e)}var t=[];return e.forEach(function(e){e.getDefines&&n(e.getDefines())}),e.forEach(function(e){e.getFunctions&&n(e.getFunctions())}),n("void main() {"),e.forEach(function(e){e.getMainBody&&n(e.getMainBody())}),n("}"),t.join("\n")}n.a=r},V39N:function(e,n,t){"use strict";function r(){function e(){n=Number.POSITIVE_INFINITY,t=Number.NEGATIVE_INFINITY}var n,t;return{getMin:function(){return n},getMax:function(){return t},add:function(e){e<n&&(n=e),e>t&&(t=e)},reset:e}}n.a=r},XFig:function(e,n,t){"use strict";n.a="\nhighp float decodeFloatRGBA( vec4 v ) {\n  float a = floor(v.r * 255.0 + 0.5);\n  float b = floor(v.g * 255.0 + 0.5);\n  float c = floor(v.b * 255.0 + 0.5);\n  float d = floor(v.a * 255.0 + 0.5);\n\n  float exponent = a - 127.0;\n  float sign = 1.0 - mod(d, 2.0)*2.0;\n  float mantissa = float(a > 0.0)\n                  + b / 256.0\n                  + c / 65536.0\n                  + floor(d / 2.0) / 8388608.0;\n  return sign * mantissa * exp2(exponent);\n}\n"},XMEc:function(e,n,t){"use strict";var r=t("Zx67"),o=t.n(r),a=t("Zrlr"),i=t.n(a),u=t("wxAW"),c=t.n(u),s=t("zwoO"),f=t.n(s),d=t("Pf15"),l=t.n(d),m=t("4KA4"),p=t("a8s+"),v=t("XFig"),x=function(e){function n(e){i()(this,n);var t=f()(this,(n.__proto__||o()(n)).call(this));return t.isDecode=e,t}return l()(n,e),c()(n,[{key:"getFunctions",value:function(){if(this.isDecode)return"\n    "+p.a+"\n    "+v.a+"\n"}},{key:"getDefines",value:function(){if(this.isDecode)return"\nprecision highp float;\n\nuniform sampler2D u_particles_x;\nuniform sampler2D u_particles_y;\n\n// Which coordinate needs to be printed onto the texture\nuniform int u_out_coordinate;\n\nvarying vec2 v_tex_pos;\n"}},{key:"getMainBody",value:function(){return this.isDecode?"\n   vec2 pos = vec2(\n     decodeFloatRGBA(texture2D(u_particles_x, v_tex_pos)),\n     decodeFloatRGBA(texture2D(u_particles_y, v_tex_pos))\n   );\n":"\n    if (u_out_coordinate == 0) gl_FragColor = encodeFloatRGBA(newPos.x);\n    else if (u_out_coordinate == 1) gl_FragColor = encodeFloatRGBA(newPos.y);\n    else if (u_out_coordinate == 6) gl_FragColor = encodeFloatRGBA(get_velocity(pos).x);\n    else if (u_out_coordinate == 7) gl_FragColor = encodeFloatRGBA(get_velocity(pos).y);\n"}}]),n}(m.a);n.a=x},YJWA:function(e,n,t){"use strict";function r(e){if(!f)return void t.e(1).then(function(){f=t("nI+d"),window.stopRecord=a,r(e)}.bind(null,t)).catch(t.oe);if(d&&d.stop(),!o()){var n=document.createElement("script");return n.setAttribute("src",e||"http://localhost:8080/ffmpegserver/ffmpegserver.js"),n.onload=function(){return r(e)},void document.head.appendChild(n)}d=new f({format:"ffmpegserver",framerate:60,verbose:!0,name:"fieldplay",extension:".mp4",codec:"mpeg4",ffmpegArguments:["-b:v","12M"]}),window.isRecording=!0,d.start(),c.a.fire("start-record",d)}function o(){return"undefined"!=typeof FFMpegServer}function a(){window.isRecording=!1,c.a.fire("stop-record",d),d.stop(),d.save()}Object.defineProperty(n,"__esModule",{value:!0});var i=t("JHsM"),u=t("eBcr"),c=t.n(u),s=document.getElementById("scene");s&&function(e){e.width=window.innerWidth,e.height=window.innerHeight;var n={antialiasing:!1},r=e.getContext("webgl",n)||e.getContext("experimental-webgl",n);if(r){window.webgGLEnabled=!0;var o=t.i(i.a)(r);o.start(),window.scene=o}else window.webgGLEnabled=!1}(s),t.e(0).then(function(){t("WOBu")}.bind(null,t)).catch(t.oe);var f,d;window.startRecord=r,window.isRecording=!1},"a8s+":function(e,n,t){"use strict";n.a="\nvec4 encodeFloatRGBA(highp float val) {\n    if (val == 0.0) {\n        return vec4(0.0, 0.0, 0.0, 0.0);\n    }\n\n    float mag = abs(val);\n    float exponent = floor(log2(mag));\n    // Correct log2 approximation errors.\n    exponent += float(exp2(exponent) <= mag / 2.0);\n    exponent -= float(exp2(exponent) > mag);\n\n    float mantissa;\n    if (exponent > 100.0) {\n        // Not sure why this needs to be done in two steps for the largest float to work.\n        // Best guess is the optimizer rewriting '/ exp2(e)' into '* exp2(-e)',\n        // but exp2(-128.0) is too small to represent.\n        mantissa = mag / 1024.0 / exp2(exponent - 10.0) - 1.0;\n    } else {\n        mantissa = mag / float(exp2(exponent)) - 1.0;\n    }\n\n    float a = exponent + 127.0;\n    mantissa *= 256.0;\n    float b = floor(mantissa);\n    mantissa -= b;\n    mantissa *= 256.0;\n    float c = floor(mantissa);\n    mantissa -= c;\n    mantissa *= 128.0;\n    float d = floor(mantissa) * 2.0 + float(val < 0.0);\n    return vec4(a, b, c, d) / 255.0;\n}\n"},aZPT:function(e,n,t){"use strict";function r(e,n){e.getMethods&&n.push(e.getMethods())}function o(e,n){e.getMain&&n.push(e.getMain())}function a(e,n){function t(){return"\nuniform sampler2D u_colors;\nuniform vec2 u_velocity_range;\n\nvarying vec4 v_particle_color;\n"+a.getDefines()+"\n"+i.getDefines()+"\n"}function r(){return"\n// https://github.com/hughsk/glsl-hsv2rgb\nvec3 hsv2rgb(vec3 c) {\n  vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n  vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n  return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\n\n"+a.getFunctions()+"\n"+i.getFunctions()+"\n"}function o(){return"\nvec2 velocity = rk4(v_particle_pos);\n"+(e===m.a.VELOCITY?"\n  float speed = (length(velocity) - u_velocity_range[0])/(u_velocity_range[1] - u_velocity_range[0]);\n  v_particle_color = vec4(hsv2rgb(vec3(0.05 + (1. - speed) * 0.5, 0.9, 1.)), 1.0);\n":"\n  float speed = (atan(velocity.y, velocity.x) + PI)/(2.0 * PI);\n  v_particle_color = vec4(hsv2rgb(vec3(speed, 0.9, 1.)), 1.0);\n")+"\n"}var a=new p.a(n),i=new v.a;return{getVariables:t,getMain:o,getMethods:r}}function i(){return{getVariables:function(){},getMain:function(){}}}function u(){function e(){return"\nuniform sampler2D u_particles_x;\nuniform sampler2D u_particles_y;\n    "}function n(){return"\n  vec2 v_particle_pos = vec2(\n    decodeFloatRGBA(texture2D(u_particles_x, txPos)),\n    decodeFloatRGBA(texture2D(u_particles_y, txPos))\n  );\n"}return{getVariables:e,getMain:n}}var c=t("Zrlr"),s=t.n(c),f=t("wxAW"),d=t.n(f),l=t("XFig"),m=t("6c6E"),p=t("DuZ1"),v=t("i69e"),x=function(){function e(n){s()(this,e),this.colorMode=n,this.isUniformColor=n===m.a.UNIFORM}return d()(e,[{key:"getFragmentShader",value:function(){var e=[],n=[];return this.isUniformColor?(e.push("uniform vec4 u_particle_color;"),n.push("gl_FragColor = u_particle_color;")):(e.push("varying vec4 v_particle_color;"),n.push("gl_FragColor = v_particle_color;")),"precision highp float;\n"+e.join("\n")+"\n\nvoid main() {\n"+n.join("\n")+"\n}"}},{key:"getVertexShader",value:function(e){var n=u(),t=this.isUniformColor?i():a(this.colorMode,e),c=[];r(n,c),r(t,c);var s=[];return o(n,s),o(t,s),"precision highp float;\nattribute float a_index;\nuniform float u_particles_res;\nuniform vec2 u_min;\nuniform vec2 u_max;\n\n"+(n.getVariables()||"")+"\n"+(t.getVariables()||"")+"\n\n"+l.a+"\n\n"+c.join("\n")+"\n\nvoid main() {\n  vec2 txPos = vec2(\n        fract(a_index / u_particles_res),\n        floor(a_index / u_particles_res) / u_particles_res);\n  gl_PointSize = 1.0;\n\n"+s.join("\n")+"\n\n  vec2 du = (u_max - u_min);\n  v_particle_pos = (v_particle_pos - u_min)/du;\n  gl_Position = vec4(2.0 * v_particle_pos.x - 1.0, (1. - 2. * (v_particle_pos.y)),  0., 1.);\n}"}}]),e}();n.a=x},eBcr:function(e,n,t){var r=t("puH/");e.exports=r({})},gIFv:function(e,n,t){"use strict";function r(e){function n(){u.a.off("integration-timestep-changed",i),u.a.off("bbox-change",i),r()}function r(){g&&E.deleteTexture(g),x&&E.deleteTexture(x)}function i(){h&&clearTimeout(h),h=setTimeout(function(){w=!0,h=0},50)}function c(e){E.uniform2f(e.u_velocity_range,P.getMin(),P.getMax())}function l(){r(),_=e.particleStateResolution,b=_*_,y=new Uint8Array(4*b),T=new Uint8Array(4*b),g=a.a.createTexture(E,E.NEAREST,y,_,_),x=a.a.createTexture(E,E.NEAREST,T,_,_),i()}function m(){i()}function p(n){w&&y&&T&&(w=!1,a.a.bindFramebuffer(E,e.framebuffer,g),E.uniform1i(n.u_out_coordinate,f),E.drawArrays(E.TRIANGLES,0,6),E.readPixels(0,0,_,_,E.RGBA,E.UNSIGNED_BYTE,y),a.a.bindFramebuffer(E,e.framebuffer,x),E.uniform1i(n.u_out_coordinate,d),E.drawArrays(E.TRIANGLES,0,6),E.readPixels(0,0,_,_,E.RGBA,E.UNSIGNED_BYTE,T),v())}function v(){P.reset();for(var e=0;e<T.length;e+=4){var n=o(y,e),t=o(T,e),r=Math.sqrt(n*n+t*t);P.add(r)}}var x,g,_,h,b,y,T,w=!0,E=e.gl,P=t.i(s.a)();return function(){u.a.on("integration-timestep-changed",i),u.a.on("bbox-change",i)}(),{updateCode:m,updateParticlesPositions:p,onParticleInit:l,setColorMinMax:c,requestSpeedUpdate:i,dispose:n}}function o(e,n){return t.i(c.b)(e[n+0],e[n+1],e[n+2],e[n+3])}n.a=r;var a=t("Ddjs"),i=t("eBcr"),u=t.n(i),c=t("FaU1"),s=(t("rvz5"),t("V39N")),f=6,d=7},h62Y:function(e,n,t){"use strict";function r(e){function n(){o.a.bindFramebuffer(f,e.framebuffer,c),f.viewport(0,0,d.width,d.height),x.boundingBoxUpdated&&m?(l.dx=-(e.bbox.minX-m.minX)/(e.bbox.maxX-e.bbox.minX),l.dy=-(e.bbox.minY-m.minY)/(e.bbox.maxY-e.bbox.minY),l.scale=(e.bbox.maxX-e.bbox.minX)/(m.maxX-m.minX),u(s,e.fadeOpacity,l)):u(s,e.fadeOpacity,a)}function t(){o.a.bindFramebuffer(f,null),i(),f.enable(f.BLEND),f.blendFunc(f.SRC_ALPHA,f.ONE_MINUS_SRC_ALPHA),f.clearColor(p.r,p.g,p.b,p.a),f.clear(f.COLOR_BUFFER_BIT),u(c,1,a),f.disable(f.BLEND);var e=s;s=c,c=e,x.boundingBoxUpdated=!1,window.audioTexture&&u(window.audioTexture,1,a)}function r(){var e=d.width,n=d.height,t=new Uint8Array(e*n*4);c&&f.deleteTexture(c),s&&f.deleteTexture(s),c=o.a.createTexture(f,f.NEAREST,t,e,n),s=o.a.createTexture(f,f.NEAREST,t,e,n)}function i(){if(!m)return void(m={minX:e.bbox.minX,minY:e.bbox.minY,maxX:e.bbox.maxX,maxY:e.bbox.maxY});m.minX=e.bbox.minX,m.minY=e.bbox.minY,m.maxX=e.bbox.maxX,m.maxY=e.bbox.maxY}function u(n,t,r){var a=v;f.useProgram(a.program),o.a.bindAttribute(f,e.quadBuffer,a.a_pos,2),o.a.bindTexture(f,n,e.screenTextureUnit),f.uniform1i(a.u_screen,e.screenTextureUnit),f.uniform1f(a.u_opacity_border,.02),f.uniform1f(a.u_opacity,t),f.uniform3f(a.u_transform,r.dx,r.dy,r.scale),f.drawArrays(f.TRIANGLES,0,6)}var c,s,f=e.gl,d=e.canvasRect,l={dx:0,dy:0,scale:1},m=null,p={r:19/255,g:41/255,b:79/255,a:1};r();var v=o.a.createProgram(f,"// screen program\nprecision highp float;\n\nattribute vec2 a_pos;\nvarying vec2 v_tex_pos;\nuniform vec3 u_transform;\n\nvoid main() {\n    v_tex_pos = a_pos;\n    vec2 pos = a_pos;\n\n    // This transformation tries to move texture (raster) to the approximate position\n    // of particles on the current frame. This is needed to avoid rendering artifacts\n    // during pan/zoom: https://computergraphics.stackexchange.com/questions/5754/fading-particles-and-transition\n\n    // PS: I must admit, I wrote this formula through sweat and tears, and\n    // I still have no idea why I don't need to apply (pos.y - 0.5) to Y coordinate.\n    // Is it because I use aspect ratio for bounding box?\n    pos.x = (pos.x - 0.5) / u_transform.z - u_transform.x + 0.5 * u_transform.z;\n    pos.y = pos.y / u_transform.z + u_transform.y;\n\n    pos = 1.0 - 2.0 * pos;\n    gl_Position = vec4(pos, 0, 1);\n}","precision highp float;\nuniform sampler2D u_screen;\nuniform float u_opacity;\nuniform float u_opacity_border;\n\nvarying vec2 v_tex_pos;\n\nvoid main() {\n  vec2 p = 1.0 - v_tex_pos;\n  vec4 color = texture2D(u_screen, p);\n\n  // For some reason particles near border leave trace when we translate the texture\n  // This is my dirty hack to fix it: https://computergraphics.stackexchange.com/questions/5754/fading-particles-and-transition\n  if (p.x < u_opacity_border || p.x > 1. - u_opacity_border || p.y < u_opacity_border || p.y > 1. - u_opacity_border) {\n    gl_FragColor = vec4(0.);\n  } else {\n    // opacity fade out even with a value close to 0.0\n    gl_FragColor = vec4(floor(255.0 * color * u_opacity) / 255.0);\n  }\n}"),x={fadeOutLastFrame:n,renderCurrentScreen:t,updateScreenTextures:r,boundingBoxUpdated:!1};return x}n.a=r;var o=t("Ddjs"),a={dx:0,dy:0,scale:1}},i69e:function(e,n,t){"use strict";var r=t("Zx67"),o=t.n(r),a=t("Zrlr"),i=t.n(a),u=t("wxAW"),c=t.n(u),s=t("zwoO"),f=t.n(s),d=t("Pf15"),l=t.n(d),m=t("4KA4"),p=function(e){function n(){return i()(this,n),f()(this,(n.__proto__||o()(n)).call(this))}return l()(n,e),c()(n,[{key:"getDefines",value:function(){return"\nuniform float u_h;\n"}},{key:"getFunctions",value:function(){return"\nvec2 rk4(const vec2 point) {\n  vec2 k1 = get_velocity( point );\n  vec2 k2 = get_velocity( point + k1 * u_h * 0.5);\n  vec2 k3 = get_velocity( point + k2 * u_h * 0.5);\n  vec2 k4 = get_velocity( point + k3 * u_h);\n\n  return k1 * u_h / 6. + k2 * u_h/3. + k3 * u_h/3. + k4 * u_h/6.;\n}"}},{key:"getMainBody",value:function(){return"\n  vec2 velocity = rk4(pos);\n"}}]),n}(m.a);n.a=p},p0IO:function(e,n,t){"use strict";function r(e,n){var t=0,r=0,o=1;return{applyTransform:function(e){var a=e.x,i=e.y;0==o-e.scale&&Math.abs(a-t)<2.1&&Math.abs(i-r)<2.1||(t=a,r=i,o=e.scale,n(e))},getOwner:function(){return e}}}n.a=r},pKWO:function(e,n,t){"use strict";function r(e){function n(){_&&_.unload();var n=new a.a(e.colorMode);_=o.a.createProgram(h,n.getVertexShader(b),n.getFragmentShader())}function r(){e.frame+=1,e.frameSeed=Math.random(),g&&g.updateTextures(),y.updateParticlesPositions()}function f(){n()}function d(t){e.frame=0,b=t,y.updateCode(t),n()}function l(){if(b){p=e.particleStateResolution,x=p*p;for(var n=new Float32Array(x),r=new Uint8Array(4*x),a=new Uint8Array(4*x),i=e.bbox.minX,c=e.bbox.minY,s=e.bbox.maxX-i,f=e.bbox.maxY-c,d=0;d<x;d++)t.i(u.a)(Math.random()*s+i,r,4*d),t.i(u.a)(Math.random()*f+c,a,4*d),n[d]=d;v&&h.deleteBuffer(v),v=o.a.createBuffer(h,n),y.onParticleInit(r,a)}}function m(){var n=_;h.useProgram(n.program),o.a.bindAttribute(h,v,n.a_index,1),y.prepareToDraw(n),h.uniform1f(n.u_h,e.integrationTimeStep),h.uniform1f(n.frame,e.frame),h.uniform1f(n.u_particles_res,p);var t=e.bbox;h.uniform2f(n.u_min,t.minX,t.minY),h.uniform2f(n.u_max,t.maxX,t.maxY),h.drawArrays(h.POINTS,0,x)}var p,v,x,g,_,h=e.gl,b="",y=t.i(i.a)(e);return function(){n(),c.a.isAudioEnabled&&(g&&g.dispose(),g=t.i(s.a)(e))}(),{onParticleInit:l,updateParticlesPositions:r,drawParticles:m,updateCode:d,updateColorMode:f}}n.a=r;var o=t("Ddjs"),a=t("aZPT"),i=t("3xg8"),u=t("FaU1"),c=t("rvz5"),s=t("94y8")},pXNl:function(e,n,t){"use strict";function r(e,n,t){function r(n){u.forEach(function(t){e.uniform1i(n["u_particles_"+t.name],t.index)})}function a(){u.forEach(function(n){return e.deleteTexture(n.texture)})}function i(e,n){u.forEach(function(t){o.a.bindTexture(e,t.texture,t.index),e.uniform1i(n["u_particles_"+t.name],t.index)})}var u=n.map(function(n,r){return{texture:o.a.createTexture(e,e.NEAREST,n.particleState,t,t),index:r,name:n.name}});return{dispose:a,bindTextures:i,assignProgramUniforms:r,length:n.length,textures:u,get:function(e){return u[e]}}}n.a=r;var o=t("Ddjs")},rvz5:function(e,n,t){"use strict";n.a={isAudioEnabled:!1,vectorLinesEnabled:!1}},vhRe:function(e,n,t){"use strict";var r=t("Zx67"),o=t.n(r),a=t("Zrlr"),i=t.n(a),u=t("wxAW"),c=t.n(u),s=t("zwoO"),f=t.n(s),d=t("Pf15"),l=t.n(d),m=t("4KA4"),p=function(e){function n(e){i()(this,n);var t=f()(this,(n.__proto__||o()(n)).call(this));return t.decode=e&&e.decode,t.srcPosName=e&&e.posName||"pos",t}return l()(n,e),c()(n,[{key:"getDefines",value:function(){if(this.decode)return"\n  uniform vec2 u_min;\n  uniform vec2 u_max;\n"}},{key:"getMainBody",value:function(){return this.decode?"\n  // move particle position according to current transform\n  vec2 du = (u_max - u_min);\n  pos.x = "+this.srcPosName+".x * du.x + u_min.x;\n  pos.y = "+this.srcPosName+".y * du.y + u_min.y;\n":"\n  pos.x = ("+this.srcPosName+".x - u_min.x)/du.x;\n  pos.y = ("+this.srcPosName+".y - u_min.y)/du.y;\n"}}]),n}(m.a);n.a=p}},["YJWA"]);
//# sourceMappingURL=app.f1fc2c12614895403646.js.map